<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Loan Repayment Calculator</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --background: #f9fafb;
            --card: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            color: var(--text);
            background-color: var(--background);
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background-color: var(--card);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }
        
        h2 {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .form-group {
                grid-template-columns: 1fr 1fr;
                align-items: center;
            }
            
            .form-group label {
                margin-bottom: 0;
            }
        }
        
        label {
            font-weight: 600;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        input, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: var(--primary-dark);
        }
        
        .button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .results {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }
        
        .results-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .results-label {
            font-weight: 600;
        }
        
        .chart-container {
            margin-top: 1.5rem;
            height: 300px;
        }
        
        .lump-sums-container {
            margin-top: 1rem;
        }
        
        .lump-sum-entry {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        
        .remove-btn {
            background-color: #ef4444;
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .remove-btn:hover {
            background-color: #dc2626;
        }
        
        .payment-plan {
            height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.5rem;
            margin-top: 1rem;
        }
        
        .payment-plan table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .payment-plan th, .payment-plan td {
            padding: 0.5rem;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }
        
        .payment-plan th:first-child, .payment-plan td:first-child {
            text-align: left;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom: 2px solid var(--primary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Home Loan Repayment Calculator</h1>
            
            <div class="tabs">
                <div class="tab active" data-tab="calculator">Calculator</div>
                <div class="tab" data-tab="payment-schedule">Payment Schedule</div>
            </div>
            
            <div class="tab-content active" id="calculator-tab">
                <div class="form-group">
                    <label for="loan-amount">Loan Amount ($)</label>
                    <input type="text" id="loan-amount" value="500000">
                </div>
                
                <div class="form-group">
                    <label for="interest-rate">Interest Rate (%)</label>
                    <input type="text" id="interest-rate" value="5.5">
                </div>
                
                <div class="form-group">
                    <label for="loan-term">Loan Term (years)</label>
                    <input type="text" id="loan-term" value="30">
                </div>
                
                <div class="form-group">
                    <label for="payment-frequency">Payment Frequency</label>
                    <select id="payment-frequency">
                        <option value="monthly">Monthly</option>
                        <option value="fortnightly">Fortnightly</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="extra-payment">Regular Extra Payment ($)</label>
                    <input type="text" id="extra-payment" value="0">
                </div>
                
                <h2>Lump Sum Payments</h2>
                <div id="lump-sums-container" class="lump-sums-container"></div>
                
                <button id="add-lump-sum">Add Lump Sum Payment</button>
                
                <div class="button-group">
                    <button id="calculate-btn">Calculate</button>
                    <button id="reset-btn">Reset</button>
                </div>
                
                <div class="results" id="results-container">
                    <h2>Loan Summary</h2>
                    
                    <div class="results-row">
                        <span class="results-label">Regular Payment:</span>
                        <span id="regular-payment">$0</span>
                    </div>
                    
                    <div class="results-row">
                        <span class="results-label">Total Interest:</span>
                        <span id="total-interest">$0</span>
                    </div>
                    
                    <div class="results-row">
                        <span class="results-label">Loan Payoff Date:</span>
                        <span id="payoff-date">-</span>
                    </div>
                    
                    <div class="results-row">
                        <span class="results-label">Time Saved:</span>
                        <span id="time-saved">-</span>
                    </div>
                    
                    <div class="results-row">
                        <span class="results-label">Interest Saved:</span>
                        <span id="interest-saved">$0</span>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="comparison-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="payment-schedule-tab">
                <h2>Payment Schedule</h2>
                <div class="payment-plan" id="payment-schedule">
                    <p>Calculate loan repayments to see the payment schedule.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loanAmountInput = document.getElementById('loan-amount');
            const interestRateInput = document.getElementById('interest-rate');
            const loanTermInput = document.getElementById('loan-term');
            const paymentFrequencySelect = document.getElementById('payment-frequency');
            const extraPaymentInput = document.getElementById('extra-payment');
            const lumpSumsContainer = document.getElementById('lump-sums-container');
            const addLumpSumBtn = document.getElementById('add-lump-sum');
            const calculateBtn = document.getElementById('calculate-btn');
            const resetBtn = document.getElementById('reset-btn');
            const resultsContainer = document.getElementById('results-container');
            const paymentScheduleContainer = document.getElementById('payment-schedule');
            
            // Result output elements
            const regularPaymentOutput = document.getElementById('regular-payment');
            const totalInterestOutput = document.getElementById('total-interest');
            const payoffDateOutput = document.getElementById('payoff-date');
            const timeSavedOutput = document.getElementById('time-saved');
            const interestSavedOutput = document.getElementById('interest-saved');
            
            // Chart
            let comparisonChart = null;
            
            // Tab navigation
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Allow only numbers and decimals in numeric fields
            const numericInputs = [loanAmountInput, interestRateInput, loanTermInput, extraPaymentInput];
            numericInputs.forEach(input => {
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9.]/g, '');
                });
            });
            
            // Add lump sum payment
            let lumpSumCount = 0;
            addLumpSumBtn.addEventListener('click', addLumpSumField);
            
            function addLumpSumField() {
                const lumpSumId = `lump-sum-${lumpSumCount}`;
                const lumpSumMonthId = `lump-sum-month-${lumpSumCount}`;
                
                const lumpSumEntry = document.createElement('div');
                lumpSumEntry.className = 'lump-sum-entry';
                lumpSumEntry.innerHTML = `
                    <input type="text" id="${lumpSumId}" placeholder="Amount ($)" class="lump-sum-amount">
                    <input type="text" id="${lumpSumMonthId}" placeholder="After month number" class="lump-sum-month">
                    <button class="remove-btn" data-id="${lumpSumCount}">âœ•</button>
                `;
                
                lumpSumsContainer.appendChild(lumpSumEntry);
                
                // Add event listener to only allow numbers in the new inputs
                const newAmountInput = document.getElementById(lumpSumId);
                const newMonthInput = document.getElementById(lumpSumMonthId);
                
                [newAmountInput, newMonthInput].forEach(input => {
                    input.addEventListener('input', function() {
                        this.value = this.value.replace(/[^0-9.]/g, '');
                    });
                });
                
                // Add event listener to remove button
                const removeBtn = lumpSumEntry.querySelector('.remove-btn');
                removeBtn.addEventListener('click', function() {
                    lumpSumEntry.remove();
                });
                
                lumpSumCount++;
            }
            
            // Calculate loan
            calculateBtn.addEventListener('click', calculateLoan);
            
            // Reset form
            resetBtn.addEventListener('click', function() {
                loanAmountInput.value = '500000';
                interestRateInput.value = '5.5';
                loanTermInput.value = '30';
                paymentFrequencySelect.value = 'monthly';
                extraPaymentInput.value = '0';
                lumpSumsContainer.innerHTML = '';
                
                // Reset results
                regularPaymentOutput.textContent = '$0';
                totalInterestOutput.textContent = '$0';
                payoffDateOutput.textContent = '-';
                timeSavedOutput.textContent = '-';
                interestSavedOutput.textContent = '$0';
                
                // Clear payment schedule
                paymentScheduleContainer.innerHTML = '<p>Calculate loan repayments to see the payment schedule.</p>';
                
                // Clear chart
                if (comparisonChart) {
                    comparisonChart.destroy();
                    comparisonChart = null;
                }
            });
            
            function calculateLoan() {
                // Get input values
                const loanAmount = parseFloat(loanAmountInput.value.replace(/,/g, '')) || 0;
                const interestRate = parseFloat(interestRateInput.value) || 0;
                const loanTerm = parseFloat(loanTermInput.value) || 0;
                const paymentFrequency = paymentFrequencySelect.value;
                const extraPayment = parseFloat(extraPaymentInput.value.replace(/,/g, '')) || 0;
                
                // Validate inputs
                if (loanAmount <= 0 || interestRate <= 0 || loanTerm <= 0) {
                    alert('Please enter valid loan details.');
                    return;
                }
                
                // Calculate payment frequency
                let paymentsPerYear;
                switch (paymentFrequency) {
                    case 'weekly':
                        paymentsPerYear = 52;
                        break;
                    case 'fortnightly':
                        paymentsPerYear = 26;
                        break;
                    case 'monthly':
                    default:
                        paymentsPerYear = 12;
                        break;
                }
                
                // Calculate total number of payments
                const totalPayments = loanTerm * paymentsPerYear;
                
                // Calculate interest rate per period
                const interestRatePerPeriod = (interestRate / 100) / paymentsPerYear;
                
                // Calculate regular payment amount using the mortgage formula
                const regularPayment = loanAmount * (interestRatePerPeriod * Math.pow(1 + interestRatePerPeriod, totalPayments)) / (Math.pow(1 + interestRatePerPeriod, totalPayments) - 1);
                
                // Get lump sum payments
                const lumpSumPayments = [];
                const lumpSumElements = document.querySelectorAll('.lump-sum-entry');
                
                lumpSumElements.forEach(element => {
                    const amountInput = element.querySelector('.lump-sum-amount');
                    const monthInput = element.querySelector('.lump-sum-month');
                    
                    const amount = parseFloat(amountInput.value.replace(/,/g, '')) || 0;
                    const month = parseInt(monthInput.value) || 0;
                    
                    if (amount > 0 && month > 0) {
                        lumpSumPayments.push({ amount, month });
                    }
                });
                
                // Sort lump sum payments by month
                lumpSumPayments.sort((a, b) => a.month - b.month);
                
                // Calculate standard amortization schedule
                const standardSchedule = calculateAmortizationSchedule(
                    loanAmount, 
                    interestRatePerPeriod, 
                    totalPayments, 
                    regularPayment, 
                    0, 
                    []
                );
                
                // Calculate accelerated amortization schedule
                const acceleratedSchedule = calculateAmortizationSchedule(
                    loanAmount, 
                    interestRatePerPeriod, 
                    totalPayments, 
                    regularPayment, 
                    extraPayment, 
                    lumpSumPayments
                );
                
                // Update UI with results
                regularPaymentOutput.textContent = formatCurrency(regularPayment);
                totalInterestOutput.textContent = formatCurrency(standardSchedule.totalInterest);
                
                // Calculate payoff date
                const currentDate = new Date();
                const payoffDate = new Date(currentDate);
                
                // Add months based on the actual number of payments in the accelerated schedule
                switch (paymentFrequency) {
                    case 'weekly':
                        payoffDate.setDate(payoffDate.getDate() + (7 * acceleratedSchedule.paymentsMade));
                        break;
                    case 'fortnightly':
                        payoffDate.setDate(payoffDate.getDate() + (14 * acceleratedSchedule.paymentsMade));
                        break;
                    case 'monthly':
                    default:
                        payoffDate.setMonth(payoffDate.getMonth() + acceleratedSchedule.paymentsMade);
                        break;
                }
                
                payoffDateOutput.textContent = payoffDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Calculate time saved
                const standardPayments = standardSchedule.paymentsMade;
                const acceleratedPayments = acceleratedSchedule.paymentsMade;
                const paymentsSaved = standardPayments - acceleratedPayments;
                
                let timeSavedText = '';
                switch (paymentFrequency) {
                    case 'weekly':
                        timeSavedText = formatTimeSaved(paymentsSaved, 'week');
                        break;
                    case 'fortnightly':
                        timeSavedText = formatTimeSaved(paymentsSaved, 'fortnight');
                        break;
                    case 'monthly':
                    default:
                        timeSavedText = formatTimeSaved(paymentsSaved, 'month');
                        break;
                }
                
                timeSavedOutput.textContent = timeSavedText;
                
                // Calculate interest saved
                const interestSaved = standardSchedule.totalInterest - acceleratedSchedule.totalInterest;
                interestSavedOutput.textContent = formatCurrency(interestSaved);
                
                // Generate payment schedule
                generatePaymentSchedule(acceleratedSchedule.schedule, paymentFrequency);
                
                // Update comparison chart
                updateComparisonChart(standardSchedule.schedule, acceleratedSchedule.schedule);
            }
            
            function calculateAmortizationSchedule(loanAmount, interestRatePerPeriod, totalPayments, regularPayment, extraPayment, lumpSumPayments) {
                let remainingBalance = loanAmount;
                let totalInterest = 0;
                let paymentsMade = 0;
                const schedule = [];
                
                // Copy lump sum payments to avoid modifying the original array
                const pendingLumpSums = [...lumpSumPayments];
                
                for (let paymentNumber = 1; paymentNumber <= totalPayments; paymentNumber++) {
                    // Check if there are any lump sum payments for this period
                    let lumpSumAmount = 0;
                    while (pendingLumpSums.length > 0 && pendingLumpSums[0].month === paymentNumber) {
                        lumpSumAmount += pendingLumpSums.shift().amount;
                    }
                    
                    // Calculate interest for this period
                    const interestPayment = remainingBalance * interestRatePerPeriod;
                    
                    // Calculate principal for this period (regular payment + extra payment)
                    let principalPayment = regularPayment - interestPayment;
                    
                    // Add extra payment
                    principalPayment += extraPayment;
                    
                    // Add lump sum payment
                    principalPayment += lumpSumAmount;
                    
                    // Make sure we don't pay more than the remaining balance
                    if (principalPayment > remainingBalance) {
                        principalPayment = remainingBalance;
                    }
                    
                    // Update remaining balance
                    remainingBalance -= principalPayment;
                    
                    // Update total interest
                    totalInterest += interestPayment;
                    
                    // Add payment to schedule
                    schedule.push({
                        paymentNumber,
                        regularPayment: regularPayment,
                        extraPayment: extraPayment,
                        lumpSumPayment: lumpSumAmount,
                        interestPayment: interestPayment,
                        principalPayment: principalPayment,
                        remainingBalance: remainingBalance
                    });
                    
                    // Increment payments made
                    paymentsMade++;
                    
                    // If loan is paid off, break out of loop
                    if (remainingBalance <= 0) {
                        break;
                    }
                }
                
                return {
                    schedule,
                    totalInterest,
                    paymentsMade
                };
            }
            
            function generatePaymentSchedule(schedule, paymentFrequency) {
                // Clear previous schedule
                paymentScheduleContainer.innerHTML = '';
                
                // Create table
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Payment #</th>
                            <th>Regular</th>
                            <th>Extra</th>
                            <th>Lump Sum</th>
                            <th>Interest</th>
                            <th>Principal</th>
                            <th>Remaining</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;
                
                // Get table body
                const tableBody = table.querySelector('tbody');
                
                // Add rows for each payment
                schedule.forEach(payment => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${payment.paymentNumber}</td>
                        <td>${formatCurrency(payment.regularPayment)}</td>
                        <td>${formatCurrency(payment.extraPayment)}</td>
                        <td>${formatCurrency(payment.lumpSumPayment)}</td>
                        <td>${formatCurrency(payment.interestPayment)}</td>
                        <td>${formatCurrency(payment.principalPayment)}</td>
                        <td>${formatCurrency(payment.remainingBalance)}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // Add table to container
                paymentScheduleContainer.appendChild(table);
            }
            
            function updateComparisonChart(standardSchedule, acceleratedSchedule) {
                // Get canvas element
                const chartCanvas = document.getElementById('comparison-chart');
                
                // Destroy previous chart if it exists
                if (comparisonChart) {
                    comparisonChart.destroy();
                }
                
                // Prepare data for chart
                const standardBalances = standardSchedule.map(payment => payment.remainingBalance);
                const acceleratedBalances = acceleratedSchedule.map(payment => payment.remainingBalance);
                
                // Make sure both arrays have the same length for comparison
                const maxLength = Math.max(standardBalances.length, acceleratedBalances.length);
                
                for (let i = standardBalances.length; i < maxLength; i++) {
                    standardBalances.push(0);
                }
                
                for (let i = acceleratedBalances.length; i < maxLength; i++) {
                    acceleratedBalances.push(0);
                }
                
                // Create labels (payment numbers)
                const labels = Array.from({ length: maxLength }, (_, i) => i + 1);
                
                // Create chart
                comparisonChart = new Chart(chartCanvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Standard Repayment',
                                data: standardBalances,
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                fill: true
                            },
                            {
                                label: 'Accelerated Repayment',
                                data: acceleratedBalances,
                                borderColor: '#22c55e',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Loan Balance Comparison'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString('en-US', { 
                                            minimumFractionDigits: 0,
                                            maximumFractionDigits: 0
                                        });
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Helper function to format currency
            function formatCurrency(amount) {
                return '$' + amount.toLocaleString('en-US', { 
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
            
            // Helper function to format time saved
            function formatTimeSaved(units, unitName) {
                if (units <= 0) {
                    return 'No time saved';
                }
                
                const years = Math.floor(units / (unitName === 'month' ? 12 : unitName === 'fortnight' ? 26 : 52));
                const remainingUnits = units % (unitName === 'month' ? 12 : unitName === 'fortnight' ? 26 : 52);
                
                let timeSavedText = '';
                
                if (years > 0) {
                    timeSavedText += `${years} year${years !== 1 ? 's' : ''}`;
                    
                    if (remainingUnits > 0) {
                        timeSavedText += ` and ${remainingUnits} ${unitName}${remainingUnits !== 1 ? 's' : ''}`;
                    }
                } else {
                    timeSavedText = `${units} ${unitName}${units !== 1 ? 's' : ''}`;
                }
                
                return timeSavedText;
            }
        });
    </script>
</body>
</html>
